# 实施计划

- [x] 1. 项目初始化和基础配置





  - 创建项目根目录结构（photo-butler/）
  - 创建前端目录（frontend/）用于Next.js应用
  - 创建后端目录（backend/）用于Express服务器
  - 创建共享资源目录（uploads/）用于临时文件存储
  - 创建测试目录（tests/）用于测试文件
  - 创建文档目录（docs/）用于项目文档和工作日志（如需要）
  - 初始化Next.js项目（在frontend/目录）
  - 初始化Express项目（在backend/目录）
  - 配置TypeScript和ESLint
  - 配置Tailwind CSS
  - 配置环境变量文件（.env.example）
  - _需求：所有需求的基础_

- [x] 2. 实现模板管理系统





  - 创建模板数据模型和类型定义
  - 实现从image文件夹读取模板预览图的功能
  - 实现从prompt.txt解析提示词的功能
  - 实现模板文件名解析逻辑（去除扩展名）
  - _需求：7.1, 7.2, 7.3_

- [ ] 2.1 编写属性测试：文件名解析






  - **属性 22：模板文件名解析**
  - **验证：需求 7.1, 7.2**

- [ ]* 2.2 编写属性测试：模板配置加载
  - **属性 23：模板配置加载**
  - **验证：需求 7.3**

- [x] 3. 实现后端API：模板列表接口








  - 创建GET /api/templates路由
  - 实现模板列表返回逻辑
  - 处理模板预览图缺失的情况（默认占位图）
  - 添加错误处理和日志记录
  - _需求：2.2, 7.4, 7.5_

- [ ]* 3.1 编写属性测试：模板列表动态更新
  - **属性 24：模板列表动态更新**
  - **验证：需求 7.4**

- [x] 4. 实现图片上传功能










  - 配置Multer中间件处理文件上传
  - 创建POST /api/upload路由
  - 实现文件格式验证（JPG/PNG）
  - 实现文件大小限制（10MB）
  - 实现临时文件存储和管理
  - _需求：1.3, 1.4_

- [ ]* 4.1 编写属性测试：文件格式验证
  - **属性 1：有效图片格式接受**
  - **属性 2：无效图片格式拒绝**
  - **验证：需求 1.3, 1.4**

- [x] 5. 实现前端：ImageUploader组件










  - 创建ImageUploader组件基础结构
  - 实现文件选择功能
  - 实现拖放上传功能
  - 实现文件验证和错误提示
  - 实现图片预览显示
  - _需求：1.1, 1.2, 1.3, 1.4, 1.5_

- [x] 5.1 编写单元测试：ImageUploader组件





  - 测试文件选择功能
  - 测试拖放上传功能
  - 测试文件格式验证
  - 测试预览显示
  - _需求：1.1, 1.2, 1.3, 1.4, 1.5_
-

- [x] 6. 实现前端：TemplateGallery组件








  - 创建TemplateGallery组件基础结构
  - 实现模板列表渲染
  - 实现模板选择交互和高亮效果
  - 实现模板点击事件处理
  - 确保每个模板显示名称和预览图
  - _需求：2.1, 2.2, 2.3, 2.4_

- [x] 6.1 编写属性测试：模板显示和选择





  - **属性 4：模板显示完整性**
  - **属性 5：模板选择高亮**
  - **验证：需求 2.3, 2.4**

- [ ]* 6.2 编写单元测试：TemplateGallery组件
  - 测试模板列表渲染
  - 测试模板选择交互
  - 测试空状态显示
  - _需求：2.1, 2.2, 2.3, 2.4_

- [x] 7. 实现前端：PromptEditor组件





  - 创建PromptEditor组件基础结构
  - 实现提示词文本输入框
  - 实现提示词加载功能（从选中模板）
  - 实现提示词编辑和实时状态更新
  - 实现字符计数显示
  - 实现空提示词时禁用生成按钮的逻辑
  - _需求：3.1, 3.2, 3.3, 3.4, 3.5_

- [x] 7.1 编写属性测试：提示词编辑和状态





  - **属性 6：模板提示词加载**
  - **属性 7：提示词可编辑性**
  - **属性 8：提示词实时保存**
  - **属性 9：非空提示词启用生成**
  - **验证：需求 2.5, 3.1, 3.2, 3.3, 3.5**

- [x] 7.2 编写单元测试：PromptEditor组件





  - 测试文本编辑功能
  - 测试字符计数
  - 测试提示词重置
  - _需求：3.1, 3.2, 3.3_

- [x] 8. 实现豆包API集成服务





  - 创建DoubaoAPIClient类
  - 实现API密钥从环境变量读取
  - 实现图片生成API调用方法
  - 实现请求超时机制（30秒）
  - 实现错误处理和重试逻辑
  - 实现API响应解析
  - _需求：8.1, 8.2, 8.3, 8.4, 8.5_

- [x] 8.1 编写单元测试：豆包API客户端






  - 测试API密钥读取
  - 测试请求参数构建
  - 测试超时处理
  - 测试错误响应处理
  - _需求：8.1, 8.2, 8.3, 8.4, 8.5_

- [x] 9. 实现后端API：图片生成接口





  - 创建POST /api/generate路由
  - 实现参数验证（imageId, prompt, templateId）
  - 集成豆包API客户端调用
  - 实现生成结果返回
  - 添加错误处理和日志记录
  - _需求：4.1, 4.2, 4.3, 4.4_

- [x] 9.1 编写属性测试：API调用和响应处理






  - **属性 10：API调用参数完整性**
  - **属性 12：API成功响应处理**
  - **属性 13：API失败响应处理**
  - **验证：需求 4.1, 4.3, 4.4, 8.2, 8.3, 8.5**

- [x] 9.2 编写单元测试：生成接口





  - 测试生成请求处理
  - 测试参数验证
  - 测试错误响应
  - _需求：4.1, 4.2, 4.3, 4.4_

- [x] 10. 实现前端：ImageGenerator组件





  - 创建ImageGenerator组件基础结构
  - 实现生成按钮和触发逻辑
  - 实现加载状态指示器
  - 实现生成结果显示
  - 实现错误提示和重试功能
  - 集成前端API调用
  - _需求：4.1, 4.2, 4.3, 4.4_

- [x] 10.1 编写属性测试：生成流程状态管理





  - **属性 11：API调用加载状态**
  - **验证：需求 4.2**

- [ ]* 10.2 编写单元测试：ImageGenerator组件
  - 测试生成按钮点击
  - 测试加载状态显示
  - 测试结果显示
  - 测试错误处理
  - _需求：4.1, 4.2, 4.3, 4.4_

- [x] 11. 实现历史记录本地存储功能




  - 创建localStorage工具函数
  - 实现历史记录保存功能
  - 实现历史记录读取功能
  - 实现历史记录清空功能
  - 处理localStorage已满的错误情况
  - _需求：4.5, 6.1_

- [ ]* 11.1 编写属性测试：历史记录持久化
  - **属性 14：生成记录持久化**
  - **验证：需求 4.5**

- [x] 12. 实现前端：HistoryViewer组件










  - 创建HistoryViewer组件基础结构
  - 实现历史记录列表渲染
  - 实现历史记录按时间倒序排序
  - 显示所有必需字段（原图、生成图、模板、提示词、时间）
  - 实现空状态显示
  - 实现历史记录项点击查看完整视图
  - _需求：6.1, 6.2, 6.3, 6.4, 6.5_

- [ ]* 12.1 编写属性测试：历史记录显示和排序
  - **属性 19：历史记录完整性**
  - **属性 20：历史记录时间排序**
  - **属性 21：历史记录点击展示**
  - **验证：需求 6.2, 6.4, 6.5**

- [ ]* 12.2 编写单元测试：HistoryViewer组件
  - 测试历史记录加载
  - 测试空状态显示
  - 测试记录排序
  - 测试记录点击
  - _需求：6.1, 6.2, 6.3, 6.4, 6.5_

- [x] 13. 实现图片下载功能





  - 创建GET /api/download/:imageId路由
  - 实现图片文件读取和返回
  - 实现前端下载按钮组件
  - 实现下载文件命名逻辑（包含时间戳和模板名称）
  - 确保下载后页面状态不变
  - 实现未生成图片时隐藏下载按钮
  - _需求：5.1, 5.2, 5.3, 5.4, 5.5_

- [x] 13.1 编写属性测试：下载功能






  - **属性 15：下载按钮显示**
  - **属性 16：下载功能触发**
  - **属性 17：下载文件命名**
  - **属性 18：下载后状态不变性**
  - **验证：需求 5.1, 5.2, 5.3, 5.4**

- [ ]* 13.2 编写单元测试：下载功能
  - 测试下载按钮显示逻辑
  - 测试下载触发
  - 测试文件命名
  - _需求：5.1, 5.2, 5.3, 5.4, 5.5_

- [x] 14. 实现主页面整合





  - 创建主页面组件（Home Page）
  - 整合所有子组件（ImageUploader, TemplateGallery, PromptEditor, ImageGenerator）
  - 实现组件间状态管理和数据流
  - 实现页面布局和样式
  - 确保用户流程顺畅（上传→选择→编辑→生成→下载）
  - _需求：1.1, 2.1_

- [x] 15. 实现响应式设计





  - 实现桌面端多列布局
  - 实现移动端单列自适应布局
  - 实现屏幕尺寸变化时的布局调整
  - 实现移动端图片上传（相机/相册选择）
  - 优化移动端交互体验
  - _需求：9.1, 9.2, 9.3, 9.4_

- [x] 15.1 编写属性测试：响应式布局



  - **属性 25：响应式布局调整**
  - **验证：需求 9.3**

- [x] 15.2 编写单元测试：响应式组件



  - 测试桌面布局
  - 测试移动布局
  - 测试布局切换
  - _需求：9.1, 9.2, 9.3_

- [x] 16. 实现数据库基础设施（预留）





  - 初始化SQLite数据库连接
  - 创建数据库初始化脚本
  - 创建用户表结构（预留）
  - 创建订单表结构（预留）
  - 实现数据库连接错误处理
  - 确保数据库失败不影响当前功能
  - _需求：10.1, 10.2, 10.3, 10.4, 10.5_

- [ ]* 16.1 编写单元测试：数据库初始化
  - 测试数据库连接
  - 测试表创建
  - 测试错误处理
  - _需求：10.1, 10.2, 10.5_

- [x] 17. 实现错误处理和日志系统





  - 创建统一的错误处理中间件
  - 实现前端错误边界组件
  - 实现Toast通知组件
  - 配置后端日志系统
  - 实现错误日志记录
  - _需求：所有需求的错误处理_

- [ ]* 17.1 编写单元测试：错误处理
  - 测试错误边界
  - 测试Toast通知
  - 测试错误日志记录
  - _需求：所有需求的错误处理_

- [x] 18. 性能优化





  - 实现图片压缩和缩略图生成
  - 实现模板预览图懒加载
  - 实现代码分割和动态导入
  - 优化状态管理（使用useMemo和useCallback）
  - 实现临时文件定期清理
  - _需求：所有需求的性能优化_

- [x] 19. 安全加固





  - 实现输入验证和清理
  - 配置CORS策略
  - 实现文件上传安全检查
  - 配置环境变量保护API密钥
  - 实现速率限制（预留）
  - _需求：所有需求的安全考虑_

- [x] 20. 检查点 - 确保所有测试通过





  - 确保所有测试通过，如有问题请询问用户

- [x] 21. 端到端测试








  - 配置Playwright测试环境
  - 编写完整生成流程E2E测试
  - 编写错误处理流程E2E测试
  - 编写响应式布局E2E测试
  - _需求：所有需求的集成测试_

- [x] 22. 文档和部署准备





  - 编写README.md文档
  - 编写API文档
  - 创建环境变量配置示例文件
  - 编写部署指南
  - 创建开发环境启动脚本
  - _需求：项目文档_
