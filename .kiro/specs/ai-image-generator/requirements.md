# 需求文档

## 简介

本系统是一个基于豆包API的AI图片生成网页应用。用户可以上传参考图片，选择预设的风格模板，编辑提示词，然后生成具有特定艺术风格的图片。系统支持图片下载和历史记录查看功能。

## 术语表

- **系统 (System)**: 指整个AI图片生成网页应用
- **用户 (User)**: 使用本网页应用的终端用户
- **参考图片 (Reference Image)**: 用户上传的原始图片，作为生成的基础
- **模板 (Template)**: 预设的风格模板，包含名称、预览图和对应的提示词
- **提示词 (Prompt)**: 用于指导AI生成图片的中文文本描述
- **豆包API (Doubao API)**: 字节跳动提供的AI图片生成服务接口
- **生成记录 (Generation History)**: 用户的图片生成历史，包含原图、生成图、模板和提示词等信息
- **会话存储 (Session Storage)**: 浏览器本地存储，用于保存当前会话的数据

## 需求

### 需求 1：图片上传

**用户故事：** 作为用户，我想要上传一张参考图片，以便系统能够基于这张图片生成新的艺术风格图片。

#### 验收标准

1. WHEN 用户访问系统首页 THEN 系统应当显示图片上传区域
2. WHEN 用户点击上传区域 THEN 系统应当打开文件选择对话框
3. WHEN 用户选择JPG或PNG格式的图片文件 THEN 系统应当接受该文件并显示预览
4. WHEN 用户选择非JPG或PNG格式的文件 THEN 系统应当拒绝该文件并显示错误提示信息
5. WHEN 图片上传成功 THEN 系统应当在上传区域显示图片缩略图预览

### 需求 2：模板选择

**用户故事：** 作为用户，我想要从模板库中选择一个艺术风格模板，以便快速应用预设的风格效果。

#### 验收标准

1. WHEN 用户上传参考图片后 THEN 系统应当显示模板选择区域
2. WHEN 系统加载模板库 THEN 系统应当显示5到10个可用模板
3. WHEN 系统显示每个模板 THEN 系统应当展示模板名称和预览图
4. WHEN 用户点击某个模板 THEN 系统应当高亮显示该模板并标记为已选中
5. WHEN 用户选择模板 THEN 系统应当将该模板对应的提示词加载到提示词编辑区域

### 需求 3：提示词编辑

**用户故事：** 作为用户，我想要查看和编辑模板的提示词，以便根据我的需求微调生成效果。

#### 验收标准

1. WHEN 用户选择一个模板 THEN 系统应当在提示词输入框中显示该模板的完整提示词
2. WHEN 提示词显示在输入框中 THEN 系统应当允许用户自由编辑文本内容
3. WHEN 用户编辑提示词 THEN 系统应当实时保存用户的修改
4. WHEN 提示词输入框为空 THEN 系统应当禁用图片生成按钮
5. WHEN 提示词输入框包含有效文本 THEN 系统应当启用图片生成按钮

### 需求 4：图片生成

**用户故事：** 作为用户，我想要基于上传的图片和编辑后的提示词生成新图片，以便获得我想要的艺术效果。

#### 验收标准

1. WHEN 用户点击生成按钮 THEN 系统应当调用豆包API并传入参考图片和提示词
2. WHEN 系统调用API THEN 系统应当显示加载状态指示器
3. WHEN API返回生成的图片 THEN 系统应当在结果区域显示生成的图片
4. WHEN API调用失败 THEN 系统应当显示错误信息并允许用户重试
5. WHEN 图片生成成功 THEN 系统应当将生成记录保存到浏览器本地存储

### 需求 5：图片下载

**用户故事：** 作为用户，我想要下载生成的图片，以便保存到本地使用。

#### 验收标准

1. WHEN 图片生成成功 THEN 系统应当在生成图片下方显示下载按钮
2. WHEN 用户点击下载按钮 THEN 系统应当触发浏览器下载功能
3. WHEN 下载开始 THEN 系统应当使用有意义的文件名保存图片
4. WHEN 下载完成 THEN 系统应当保持当前页面状态不变
5. WHEN 用户未生成图片 THEN 系统应当隐藏或禁用下载按钮

### 需求 6：历史记录查看

**用户故事：** 作为用户，我想要查看我的图片生成历史记录，以便回顾之前的生成结果。

#### 验收标准

1. WHEN 用户访问历史记录页面 THEN 系统应当从浏览器本地存储读取历史记录
2. WHEN 系统显示历史记录 THEN 系统应当展示原图缩略图、生成图缩略图、使用的模板名称、提示词和生成时间
3. WHEN 历史记录为空 THEN 系统应当显示空状态提示信息
4. WHEN 历史记录按时间排序 THEN 系统应当将最新的记录显示在最前面
5. WHEN 用户点击历史记录中的生成图 THEN 系统应当显示该图片的完整视图

### 需求 7：模板管理

**用户故事：** 作为系统管理员，我想要能够添加新的模板，以便扩展系统的风格选项。

#### 验收标准

1. WHEN 管理员添加新模板预览图到image文件夹 THEN 系统应当使用文件名作为模板名称
2. WHEN 模板预览图命名格式为"名称.jpg"或"名称.png" THEN 系统应当正确解析模板名称
3. WHEN 系统读取模板配置 THEN 系统应当从prompt.txt文件中加载对应的提示词
4. WHEN 模板数量变化 THEN 系统应当在下次加载时自动更新模板列表
5. WHEN 模板预览图缺失 THEN 系统应当显示默认占位图

### 需求 8：API集成

**用户故事：** 作为系统，我需要正确集成豆包API，以便实现图片生成功能。

#### 验收标准

1. WHEN 系统初始化 THEN 系统应当从环境变量中读取豆包API密钥
2. WHEN 系统调用豆包API THEN 系统应当传入参考图片和中文提示词
3. WHEN API返回响应 THEN 系统应当正确解析返回的图片数据
4. WHEN API调用超时 THEN 系统应当在30秒后终止请求并提示用户
5. WHEN API返回错误 THEN 系统应当记录错误信息并向用户显示友好的错误提示

### 需求 9：响应式界面

**用户故事：** 作为用户，我想要在不同设备上使用系统，以便随时随地生成图片。

#### 验收标准

1. WHEN 用户在桌面浏览器访问系统 THEN 系统应当显示完整的多列布局
2. WHEN 用户在移动设备访问系统 THEN 系统应当显示单列自适应布局
3. WHEN 屏幕尺寸改变 THEN 系统应当自动调整布局和元素大小
4. WHEN 在移动设备上传图片 THEN 系统应当支持从相机或相册选择
5. WHEN 在任何设备上操作 THEN 系统应当保持良好的可用性和可读性

### 需求 10：数据持久化

**用户故事：** 作为开发者，我需要为未来的用户认证和付费功能预留数据库支持，以便后续扩展。

#### 验收标准

1. WHEN 系统启动 THEN 系统应当初始化SQLite数据库连接
2. WHEN 数据库不存在 THEN 系统应当自动创建数据库文件和必要的表结构
3. WHEN 系统设计数据模型 THEN 系统应当预留用户表和订单表的结构
4. WHEN 当前版本运行 THEN 系统应当使用浏览器本地存储而非数据库存储历史记录
5. WHEN 数据库连接失败 THEN 系统应当记录错误但不影响当前功能的使用
